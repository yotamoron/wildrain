<!DOCTYPE html>
<html lang="en">
    <head>
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.3.2/css/bootstrap-responsive.min.css" >
        <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css">
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script>
			function handleCommand(cmd) {
				if (cmd['Name'] == "SET_STATE") {
					$('#state').html(cmd['Params']['state'])
				}
				return {"success": true}
			}
			
			function handleQuery(q) {
				if (q['Name'] == "GET_STATE") {
					return {"state" : $('#state').html()};
				} else if (q['Name'] == "CURRENT_TEMPRATURE") {
					return {"temprature": $('#temp').html()}
				}
			}
			
			function handleMessage(sck, msg) {
				var data = JSON.parse(msg['data']);
				var reqId = data['ReqId'];
				var reqBody = data['Body'];
				var type = reqBody['Type'];
				var res = type == "COMMAND" ? handleCommand(reqBody['Body']) : handleQuery(reqBody['Body']);
				sck.send(JSON.stringify({"ReqId": reqId, "Body": res}));
				
			}
			$(function() {
	            var ws = new WebSocket("ws://" + document.domain + ":8080/connect");
	    		ws.onmessage = function(e) {
					handleMessage(ws, e);
	    		}

				ws.onclose = function() {
					console.log("Close");
				}
			
	    		ws.onopen = function() {
					ws.send(JSON.stringify({"applicationName": "Boiler", "applicationVersion": "1.0"}));
	    		}
				$('#state').html('off');
				$('#temp').html(25);
			});
        </script>
    </head>
    <body>
        <div class="container-fluid">
            <div class="page-header"><h2>Boiler 1.0</h2></div>
			<div class="row-fluid">
				<div class="span2">State: </div>
				<div class="span3"><div id="state" /></div>
			</div>
			<div class="row-fluid">
				<div class="span2">Temprature: </div>
				<div class="span3"><div id="temp" /></div>
			</div>
            <div id="footer"></div>
        </div>
    </body>
</html>
