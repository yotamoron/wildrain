<!DOCTYPE html>
<html lang="en">
    <head>
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.3.2/css/bootstrap-responsive.min.css" >
        <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css">
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script src="../js/wildrain.js"></script>
		<script src="../lib/codemirror.js"></script>
		<link rel="stylesheet" href="../lib/codemirror.css">
		<script src="../lib/javascript.js"></script>
        <script>
            getApplications("aicd-links", "aicdJson");
			var codeMirror;
			$(function() {
				var editorElmt = document.getElementById("editor");
				codeMirror = CodeMirror.fromTextArea(editorElmt, {
					value: "var bla = 'bla';",
					mode: "javascript",
					lineWrapping: true,
					lineNumbers: true
				});
				$('#newFlowSubmit').click(function() {
					var newFlowName = $('#newFlowName').val();
					if (newFlowName != "") {
						$('#flowName').html("<strong>" + newFlowName + "</strong");
						$('#newFlowName').val("");
						codeMirror.doc.setValue("");
					}
				});
				
				$('#saveFlow').click(function() {
					var flow = codeMirror.doc.getValue();
					var app = $('#appSelectDropdown').val();
					var ver = $('#verSelectDropdown').val();
					var event = $('#eventSelectDropdown').val();
					$.ajax({
						'url': '/saveFlow',
						'type': 'POST',
						'data': {'Flow': flow, 'ApplicationName': app, 'ApplicationVersion': ver, 'EventName': event},
						'success': function(d, x, s) {
							renderAppsSelectors();
						}
					});
					
				});
			});
        </script>
    </head>
    <body>
        <div class="container-fluid">
            <div class="page-header"><h2>WildRain</h2></div>
            <div class="tabbable">
                <ul class="nav nav-tabs" data-tabs="tabs">
                    <li class="active"><a href="#aicds" data-toggle="tab">AICDs</a></li>
                    <li><a href="#flows" data-toggle="tab">Flows</a></li>
                </ul>
                <div class="tab-content">
                    <div id="aicds" class="tab-pane active">
                        <div class="container-fluid">
                            <div class="row-fluid">
                                <div class="span2">
                                    Choose an AICD to upload: 
                                </div>
                                <div class="span8">
                                    <input id="fileupload" type="file" name="aicd">
                                </div>
                            </div>
                            <div class="row-fluid">
                                <div class="container-fluid">
                                    <div class="span4" id="aicd-links">
                                    </div>
                                    <div class="span8" id="aicdJson">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="flows" class="tab-pane">
                        <div class="container-fluid">
							<div class="span4">Flows editing links go here
							</div>
							<div class="span8">
								<div class="container-fluid">
									<div class="row-fluid">
										<div class="span4"><div id="appSelect"></div></div>
										<div class="span4"><div id="verSelect"></div></div>
										<div class="span4"><div id="eventSelect"></div></div>
									</div>
									<div class="row-fluid">
										<div class="span4"><input type="text" id="newFlowName"></div>
										<div class="span2"><button type="button" id="newFlowSubmit">New Flow!</button></div>
									</div>
								</div>
								<div class="container-fluid">
									<div class="row-fluid">
										<div id="flowName"></div>
									</div>
									<div class="row-fluid">
										<button type="button" id="saveFlow">Save</button>
										<br />
									</div>
									<div class="row-fluid">
										<textarea id="editor"></textarea>
									</div>
								</div>
							</div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="footer"></div>
        </div>
    </body>
    
</html>
